"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Mandelbrot=function(){function a(b){_classCallCheck(this,a),this.canvas=document.getElementById(b),this.context=this.canvas.getContext("2d"),this.context.canvas.width=window.innerWidth,this.context.canvas.height=window.innerHeight,this.imageData=this.context.createImageData(this.context.canvas.width,this.context.canvas.height),this.colorScheme=a.createRandomColorScheme(),this.camX=a.getDefaults().camX,this.camY=a.getDefaults().camY,this.zoom=a.getDefaults().zoom,this.formula=a.formula,this.iterations=a.getDefaults().iterations,this.mouseX=0,this.mouseY=0,this.mouseOnDrag=!1,this.numberOfStaticFrames=0,this.addEventListeners()}return _createClass(a,[{key:"addEventListeners",value:function(){var a=this;this.canvas.addEventListener("mousedown",function(b){a.onMouseDown(b)},!1),this.canvas.addEventListener("mouseup",function(){a.onMouseUp()},!1),this.canvas.addEventListener("mousemove",function(b){a.onMouseMove(b)},!1),"onwheel"in document?this.canvas.addEventListener("wheel",function(b){a.onMouseWheel(b)},!1):"onmousewheel"in document?this.canvas.addEventListener("mousewheel",function(b){a.onMouseWheel(b)},!1):this.canvas.addEventListener("MozMousePixelScroll",function(b){a.onMouseWheel(b)},!1),document.addEventListener("keydown",function(b){a.onKeyDown(b)},!1),this.renderTimerId=setInterval(function(){a.renderFrame()},1/60)}},{key:"renderFrame",value:function(){this.numberOfStaticFrames++;var b=1;if(this.numberOfStaticFrames<10)b=9;else switch(this.numberOfStaticFrames){case 10:b=6;break;case 20:b=3;break;case 30:b=1;break;default:return}for(var c=this.context.canvas.height,d=this.context.canvas.width,e=this.imageData.data,f=this.colorScheme,g=a.getDefaults().iterations,h=new ArrayBuffer(e.length),i=new Uint8ClampedArray(h),j=new Uint32Array(h),k=0;c>k;k+=b)for(var l=(c/2-k)/this.zoom+this.camY,m=0;d>m;m+=b){for(var n=(m-d/2)/this.zoom+this.camX,o=this.formula(n,l);o>g;)o-=g;for(var p=k+b,q=m+b,r=k;p>r;++r)for(var s=m;q>s;++s)j[r*d+s]=255<<24|f[3*o]<<16|f[3*o+1]<<8|f[3*o+2]}e.set(i),this.context.putImageData(this.imageData,0,0)}},{key:"setNumberOfIterations",value:function(){var b=this.zoom/a.getDefaults().zoom;Math.pow(2,32)-1<b?this.iterations=16384:b>67108864?this.iterations=8192:b>524288?this.iterations=4096:b>262144?this.iterations=2048:b>4096?this.iterations=1024:this.iterations=512}},{key:"onMouseDown",value:function(){var a=arguments.length<=0||void 0===arguments[0]?window.event:arguments[0];this.mouseX=a.clientX,this.mouseY=a.clientY,this.mouseOnDrag=!0}},{key:"onMouseUp",value:function(){this.mouseOnDrag=!1}},{key:"onMouseMove",value:function(){var b=arguments.length<=0||void 0===arguments[0]?window.event:arguments[0];if(this.mouseOnDrag){var c=b.clientX,d=b.clientY;this.camX+=(-c+this.mouseX)/this.zoom,this.camY+=(d-this.mouseY)/this.zoom,this.camX>a.getDefaults().maxCamX&&(this.camX=a.getDefaults().maxCamX),this.camX<a.getDefaults().minCamX&&(this.camX=a.getDefaults().minCamX),this.camY>a.getDefaults().maxCamY&&(this.camY=a.getDefaults().maxCamY),this.camY<a.getDefaults().minCamY&&(this.camY=a.getDefaults().minCamY),this.mouseX=c,this.mouseY=d,this.numberOfStaticFrames=0}}},{key:"onMouseWheel",value:function(){var b=arguments.length<=0||void 0===arguments[0]?window.event:arguments[0],c=b.deltaY||b.detail||b.wheelDelta;Math.abs(c)<10&&(c*=10),c>0?this.zoom+=c*this.zoom/(2*a.getDefaults().zoom):(this.zoom+=c*this.zoom/(5*a.getDefaults().zoom),this.zoom<a.getDefaults().zoom&&(this.zoom=a.getDefaults().zoom)),this.setNumberOfIterations(),this.numberOfStaticFrames=0}},{key:"onKeyDown",value:function(){var a=arguments.length<=0||void 0===arguments[0]?window.event:arguments[0];switch(a.keyCode){case 37:this.turnLeft();break;case 38:this.turnUp();break;case 39:this.turnRight();break;case 40:this.turnDown();break;case 87:this.zoomIn();break;case 83:this.zoomOut()}}},{key:"zoomIn",value:function(){this.zoom*=1.1,this.setNumberOfIterations(),this.numberOfStaticFrames=0}},{key:"zoomOut",value:function(){this.zoom/=1.1,this.zoom<a.getDefaults().zoom&&(this.zoom=a.getDefaults().zoom),this.setNumberOfIterations(),this.numberOfStaticFrames=0}},{key:"turnRight",value:function(){this.camX+=25/this.zoom,this.camX>a.getDefaults().maxCamX&&(this.camX=a.getDefaults().maxCamX),this.numberOfStaticFrames=0}},{key:"turnLeft",value:function(){this.camX-=25/this.zoom,this.camX<a.getDefaults().minCamX&&(this.camX=a.getDefaults().minCamX),this.numberOfStaticFrames=0}},{key:"turnUp",value:function(){this.camY+=25/this.zoom,this.camY>a.getDefaults().maxCamY&&(this.camY=a.getDefaults().maxCamY),this.numberOfStaticFrames=0}},{key:"turnDown",value:function(){this.camY-=25/this.zoom,this.camY<a.getDefaults().minCamY&&(this.camY=a.getDefaults().minCamY),this.numberOfStaticFrames=0}},{key:"cameraX",value:function(){return this.camX}},{key:"cameraY",value:function(){return this.camY}},{key:"cameraZoom",value:function(){return this.zoom}}],[{key:"getDefaults",value:function(){return{camX:0,camY:0,zoom:200,iterations:512,maxCamX:3,minCamX:-3,maxCamY:1.7,minCamY:-1.7}}},{key:"createRandomColorScheme",value:function(){var b=[];b[0]=8,b[1]=0,b[2]=0;for(var c=a.getDefaults().iterations,d=1;c>d;d+=2)d+=7,b[3*d]=Math.floor(256*a.rand(d-1)),b[3*d+1]=Math.floor(256*a.rand(d-1)),b[3*d+2]=Math.floor(256*a.rand(d+2)),d-=4,b[3*d]=(b[3*(d-4)]+b[3*(d+4)])/2,b[3*d+1]=(b[3*(d-4)+1]+b[3*(d+4)+1])/2,b[3*d+2]=(b[3*(d-4)+2]+b[3*(d+4)+2])/2,d+=2,b[3*d]=(b[3*(d-2)]+b[3*(d+2)])/2,b[3*d+1]=(b[3*(d-2)+1]+b[3*(d+2)+1])/2,b[3*d+2]=(b[3*(d-2)+2]+b[3*(d+2)+2])/2,d-=4,b[3*d]=(b[3*(d-2)]+b[3*(d+2)])/2,b[3*d+1]=(b[3*(d-2)+1]+b[3*(d+2)+1])/2,b[3*d+2]=(b[3*(d-2)+2]+b[3*(d+2)+2])/2,d-=1,b[3*d]=(b[3*(d-1)]+b[3*(d+1)])/2,b[3*d+1]=(b[3*(d-1)+1]+b[3*(d+1)+1])/2,b[3*d+2]=(b[3*(d-1)+2]+b[3*(d+1)+2])/2,d+=2,b[3*d]=(b[3*(d-1)]+b[3*(d+1)])/2,b[3*d+1]=(b[3*(d-1)+1]+b[3*(d+1)+1])/2,b[3*d+2]=(b[3*(d-1)+2]+b[3*(d+1)+2])/2,d+=2,b[3*d]=(b[3*(d-1)]+b[3*(d+1)])/2,b[3*d+1]=(b[3*(d-1)+1]+b[3*(d+1)+1])/2,b[3*d+2]=(b[3*(d-1)+2]+b[3*(d+1)+2])/2,d+=2,b[3*d]=(b[3*(d-1)]+b[3*(d+1)])/2,b[3*d+1]=(b[3*(d-1)+1]+b[3*(d+1)+1])/2,b[3*d+2]=(b[3*(d-1)+2]+b[3*(d+1)+2])/2;return b}},{key:"rand",value:function(a){var b=1e4*Math.sin(a);return b-Math.floor(b)}},{key:"formula",value:function(a,b){for(var c=a,d=b,e=this.iterations,f=0;e>f;++f){var g=c*c,h=d*d;if(g+h>4.02)return f;var i=g-h+a,j=2*c*d+b;c=i,d=j}return 0}}]),a}();